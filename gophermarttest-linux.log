=== RUN   TestGophermart
=== RUN   TestGophermart/TestEndToEnd
=== RUN   TestGophermart/TestEndToEnd/register_accrual_mechanic
=== RUN   TestGophermart/TestEndToEnd/register_order_for_accrual
=== RUN   TestGophermart/TestEndToEnd/register_user
=== RUN   TestGophermart/TestEndToEnd/order_upload
=== RUN   TestGophermart/TestEndToEnd/await_order_processed
=== RUN   TestGophermart/TestEndToEnd/check_balance
=== RUN   TestGophermart/TestEndToEnd/withdraw_balance
=== RUN   TestGophermart/TestEndToEnd/recheck_balance
=== RUN   TestGophermart/TestEndToEnd/check_withdrawals
=== RUN   TestGophermart/TestUserAuth
=== RUN   TestGophermart/TestUserAuth/register_user
=== RUN   TestGophermart/TestUserAuth/login_user
=== RUN   TestGophermart/TestUserOrders
=== RUN   TestGophermart/TestUserOrders/unauthorized_order_upload
=== RUN   TestGophermart/TestUserOrders/unauthorized_orders_list
=== RUN   TestGophermart/TestUserOrders/register_user
=== RUN   TestGophermart/TestUserOrders/bad_order_upload
=== RUN   TestGophermart/TestUserOrders/order_upload
=== RUN   TestGophermart/TestUserOrders/duplicate_order_upload_same_user
=== RUN   TestGophermart/TestUserOrders/orders_list
=== RUN   TestGophermart/TestUserOrders/duplicate_order_upload_other_user
=== NAME  TestGophermart
    gophermart_suite_test.go:105: останавливаем процесс gophermart
    gophermart_suite_test.go:140: Получен STDOUT лог процесса:
        
        time=2025-02-08T10:42:28.996+07:00 level=DEBUG msg="configuration sources" environment=local env_file_loaded=true RUN_ADDRESS="localhost:8082 (from .env)" DATABASE_URI="postgres://gophermart:password@localhost:5432/gophermart?sslmode=disable (from .env)" ACCRUAL_SYSTEM_ADDRESS="http://localhost:34245 (from .env)" JWT_SECRET=yo***v) JWT_EXPIRATION_PERIOD="24h0m0s (from .env)"
        time=2025-02-08T10:42:29.020+07:00 level=INFO msg="goose: no migrations to run. current version: 3" environment=local
        
           ____    __
          / __/___/ /  ___
         / _// __/ _ \/ _ \
        /___/\__/_//_/\___/ v4.11.4
        High performance, minimalist Go web framework
        https://echo.labstack.com
        ____________________________________O/_______
                                            O\
        time=2025-02-08T10:42:29.020+07:00 level=INFO msg="воркер начал работу" environment=local package=worker component=AccrualWorker worker_id=1
        time=2025-02-08T10:42:29.020+07:00 level=INFO msg="воркер начал работу" environment=local package=worker component=AccrualWorker worker_id=0
        ⇨ http server started on 127.0.0.1:8082
        {"time":"2025-02-08T10:42:29.236879522+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":154503321,"latency_human":"154.503321ms","bytes_in":56,"bytes_out":160}
        time=2025-02-08T10:42:29.242+07:00 level=INFO msg="created new order" environment=local id=29 uploaded_at=2025-02-08T10:42:29.241+07:00 user_id=85 order_number=208117760873325 status=NEW
        {"time":"2025-02-08T10:42:29.242937951+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":202,"error":"","latency":4970813,"latency_human":"4.970813ms","bytes_in":15,"bytes_out":0}
        {"time":"2025-02-08T10:42:30.249597178+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":4957119,"latency_human":"4.957119ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-08T10:42:31.246112258+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1863667,"latency_human":"1.863667ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-08T10:42:32.247705685+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3094879,"latency_human":"3.094879ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-08T10:42:33.248448814+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3373598,"latency_human":"3.373598ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-08T10:42:34.246771416+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2039493,"latency_human":"2.039493ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-08T10:42:35.246183162+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2019188,"latency_human":"2.019188ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-08T10:42:36.245650739+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1651742,"latency_human":"1.651742ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-08T10:42:37.247451454+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2345108,"latency_human":"2.345108ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-08T10:42:38.247009948+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1963301,"latency_human":"1.963301ms","bytes_in":0,"bytes_out":95}
        time=2025-02-08T10:42:39.021+07:00 level=DEBUG msg="начало обработки заказов" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders
        time=2025-02-08T10:42:39.021+07:00 level=DEBUG msg="запрос заказов" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders статусы="[NEW PROCESSING]"
        time=2025-02-08T10:42:39.021+07:00 level=DEBUG msg="начало обработки заказов" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders
        time=2025-02-08T10:42:39.021+07:00 level=DEBUG msg="запрос заказов" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders статусы="[NEW PROCESSING]"
        time=2025-02-08T10:42:39.025+07:00 level=DEBUG msg="поиск заказов по статусам" environment=local package=repository component=OrderRepo method=FindByStatus статусы="[NEW PROCESSING]" количество=2
        time=2025-02-08T10:42:39.025+07:00 level=DEBUG msg="кол-во заказов для обработки воркером" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders количество=2
        time=2025-02-08T10:42:39.025+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=28 "номер заказа"=12345678903 "текущий статус"=NEW
        time=2025-02-08T10:42:39.027+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=12345678903
        time=2025-02-08T10:42:39.027+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=29 "номер заказа"=208117760873325 "текущий статус"=NEW
        time=2025-02-08T10:42:39.027+07:00 level=DEBUG msg="получена информация о начислении" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=208117760873325 статус=PROCESSED начисление=0xc000015850
        time=2025-02-08T10:42:39.031+07:00 level=DEBUG msg="обновление суммы начисления" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=208117760873325 "начисление (руб)"=729.98 "начисление (коп)"=72998
        time=2025-02-08T10:42:39.031+07:00 level=INFO msg="обновление статуса на PROCESSED" environment=local package=repository component=OrderRepo method=UpdateAccrual "id заказа"=29 "начисление (коп)"=72998
        time=2025-02-08T10:42:39.035+07:00 level=DEBUG msg="поиск заказов по статусам" environment=local package=repository component=OrderRepo method=FindByStatus статусы="[NEW PROCESSING]" количество=1
        time=2025-02-08T10:42:39.035+07:00 level=DEBUG msg="кол-во заказов для обработки воркером" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders количество=1
        time=2025-02-08T10:42:39.035+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=28 "номер заказа"=12345678903 "текущий статус"=NEW
        time=2025-02-08T10:42:39.035+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=12345678903
        {"time":"2025-02-08T10:42:39.248617929+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":4517127,"latency_human":"4.517127ms","bytes_in":0,"bytes_out":118}
        {"time":"2025-02-08T10:42:39.259900502+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/balance","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":10236791,"latency_human":"10.236791ms","bytes_in":0,"bytes_out":33}
        {"time":"2025-02-08T10:42:39.266498012+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/balance/withdraw","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":5925882,"latency_human":"5.925882ms","bytes_in":47,"bytes_out":0}
        {"time":"2025-02-08T10:42:39.268424621+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/balance","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1222795,"latency_human":"1.222795ms","bytes_in":0,"bytes_out":50}
        {"time":"2025-02-08T10:42:39.270253222+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/withdrawals","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1243114,"latency_human":"1.243114ms","bytes_in":0,"bytes_out":84}
        {"time":"2025-02-08T10:42:39.424143607+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":152464062,"latency_human":"152.464062ms","bytes_in":81,"bytes_out":161}
        {"time":"2025-02-08T10:42:39.567346952+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/login","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":141610561,"latency_human":"141.610561ms","bytes_in":81,"bytes_out":161}
        {"time":"2025-02-08T10:42:39.569523812+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":401,"error":"code=401, message=Отсутствует токен авторизации","latency":66573,"latency_human":"66.573µs","bytes_in":7,"bytes_out":71}
        {"time":"2025-02-08T10:42:39.570103679+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":401,"error":"code=401, message=Отсутствует токен авторизации","latency":13210,"latency_human":"13.21µs","bytes_in":0,"bytes_out":71}
        {"time":"2025-02-08T10:42:39.703734184+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":133057236,"latency_human":"133.057236ms","bytes_in":68,"bytes_out":168}
        {"time":"2025-02-08T10:42:39.706206573+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":422,"error":"code=422, message=Неверный формат номера заказа","latency":1442514,"latency_human":"1.442514ms","bytes_in":11,"bytes_out":70}
        time=2025-02-08T10:42:39.709+07:00 level=INFO msg="created new order" environment=local id=30 uploaded_at=2025-02-08T10:42:39.707+07:00 user_id=87 order_number=555326 status=NEW
        {"time":"2025-02-08T10:42:39.709509334+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":202,"error":"","latency":2690074,"latency_human":"2.690074ms","bytes_in":6,"bytes_out":0}
        {"time":"2025-02-08T10:42:39.710978609+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":931213,"latency_human":"931.213µs","bytes_in":6,"bytes_out":0}
        {"time":"2025-02-08T10:42:39.712186394+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":721552,"latency_human":"721.552µs","bytes_in":0,"bytes_out":86}
        {"time":"2025-02-08T10:42:39.842378636+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":129172214,"latency_human":"129.172214ms","bytes_in":57,"bytes_out":160}
        {"time":"2025-02-08T10:42:39.845111681+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":409,"error":"code=409, message=Номер заказа уже был загружен другим пользователем","latency":1828346,"latency_human":"1.828346ms","bytes_in":6,"bytes_out":109}
        time=2025-02-08T10:42:39.845+07:00 level=INFO msg="received signal" environment=local signal=interrupt
        time=2025-02-08T10:42:39.845+07:00 level=INFO msg="shutting down server..." environment=local
        time=2025-02-08T10:42:39.846+07:00 level=INFO msg="server stopped" environment=local
    gophermart_suite_test.go:108: останавливаем процесс accrual
    gophermart_suite_test.go:140: Получен STDOUT лог процесса:
        
        {"level":"info","ts":1738986148.8817158,"caller":"accrual/main.go:52","msg":"starting HTTP server","addr":"localhost:34245"}
        {"level":"info","ts":1738986159.849583,"caller":"accrual/main.go:63","msg":"shutting down gracefully","signal":"interrupt"}
--- PASS: TestGophermart (10.98s)
    --- PASS: TestGophermart/TestEndToEnd (10.19s)
        --- PASS: TestGophermart/TestEndToEnd/register_accrual_mechanic (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/register_order_for_accrual (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/register_user (0.16s)
        --- PASS: TestGophermart/TestEndToEnd/order_upload (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/await_order_processed (10.01s)
        --- PASS: TestGophermart/TestEndToEnd/check_balance (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/withdraw_balance (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/recheck_balance (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/check_withdrawals (0.00s)
    --- PASS: TestGophermart/TestUserAuth (0.30s)
        --- PASS: TestGophermart/TestUserAuth/register_user (0.15s)
        --- PASS: TestGophermart/TestUserAuth/login_user (0.14s)
    --- PASS: TestGophermart/TestUserOrders (0.28s)
        --- PASS: TestGophermart/TestUserOrders/unauthorized_order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/unauthorized_orders_list (0.00s)
        --- PASS: TestGophermart/TestUserOrders/register_user (0.13s)
        --- PASS: TestGophermart/TestUserOrders/bad_order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/duplicate_order_upload_same_user (0.00s)
        --- PASS: TestGophermart/TestUserOrders/orders_list (0.00s)
        --- PASS: TestGophermart/TestUserOrders/duplicate_order_upload_other_user (0.13s)
PASS
