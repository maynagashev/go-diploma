=== RUN   TestGophermart
=== RUN   TestGophermart/TestEndToEnd
=== RUN   TestGophermart/TestEndToEnd/register_accrual_mechanic
=== RUN   TestGophermart/TestEndToEnd/register_order_for_accrual
=== RUN   TestGophermart/TestEndToEnd/register_user
=== RUN   TestGophermart/TestEndToEnd/order_upload
=== RUN   TestGophermart/TestEndToEnd/await_order_processed
=== RUN   TestGophermart/TestEndToEnd/check_balance
=== RUN   TestGophermart/TestEndToEnd/withdraw_balance
=== RUN   TestGophermart/TestEndToEnd/recheck_balance
=== RUN   TestGophermart/TestEndToEnd/check_withdrawals
=== RUN   TestGophermart/TestUserAuth
=== RUN   TestGophermart/TestUserAuth/register_user
=== RUN   TestGophermart/TestUserAuth/login_user
=== RUN   TestGophermart/TestUserOrders
=== RUN   TestGophermart/TestUserOrders/unauthorized_order_upload
=== RUN   TestGophermart/TestUserOrders/unauthorized_orders_list
=== RUN   TestGophermart/TestUserOrders/register_user
=== RUN   TestGophermart/TestUserOrders/bad_order_upload
=== RUN   TestGophermart/TestUserOrders/order_upload
=== RUN   TestGophermart/TestUserOrders/duplicate_order_upload_same_user
=== RUN   TestGophermart/TestUserOrders/orders_list
=== RUN   TestGophermart/TestUserOrders/duplicate_order_upload_other_user
=== NAME  TestGophermart
    gophermart_suite_test.go:105: останавливаем процесс gophermart
    gophermart_suite_test.go:140: Получен STDOUT лог процесса:
        
        time=2025-02-06T16:56:46.141+07:00 level=DEBUG msg="configuration sources" environment=local env_file_loaded=true RUN_ADDRESS="localhost:8082 (from .env)" DATABASE_URI="postgres://gophermart:password@localhost:5432/gophermart?sslmode=disable (from .env)" ACCRUAL_SYSTEM_ADDRESS="http://localhost:33049 (from .env)" JWT_SECRET=yo***v) JWT_EXPIRATION_PERIOD="24h0m0s (from .env)"
        time=2025-02-06T16:56:46.160+07:00 level=INFO msg="goose: no migrations to run. current version: 3" environment=local
        
           ____    __
          / __/___/ /  ___
         / _// __/ _ \/ _ \
        /___/\__/_//_/\___/ v4.11.4
        High performance, minimalist Go web framework
        https://echo.labstack.com
        ____________________________________O/_______
                                            O\
        time=2025-02-06T16:56:46.160+07:00 level=INFO msg="воркер начал работу" environment=local package=worker component=AccrualWorker worker_id=1
        time=2025-02-06T16:56:46.161+07:00 level=INFO msg="воркер начал работу" environment=local package=worker component=AccrualWorker worker_id=0
        ⇨ http server started on 127.0.0.1:8082
        {"time":"2025-02-06T16:56:46.378605665+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":141586965,"latency_human":"141.586965ms","bytes_in":51,"bytes_out":160}
        time=2025-02-06T16:56:46.384+07:00 level=INFO msg="created new order" environment=local id=26 uploaded_at=2025-02-06T16:56:46.383+07:00 user_id=70 order_number=646566768067365 status=NEW
        {"time":"2025-02-06T16:56:46.385031564+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":202,"error":"","latency":5242834,"latency_human":"5.242834ms","bytes_in":15,"bytes_out":0}
        {"time":"2025-02-06T16:56:47.391502527+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":4574262,"latency_human":"4.574262ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-06T16:56:48.390732995+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3230923,"latency_human":"3.230923ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-06T16:56:49.389729674+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2438206,"latency_human":"2.438206ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-06T16:56:50.387403129+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1498479,"latency_human":"1.498479ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-06T16:56:51.390066306+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3318971,"latency_human":"3.318971ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-06T16:56:52.390433128+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3099462,"latency_human":"3.099462ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-06T16:56:53.388648978+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1895558,"latency_human":"1.895558ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-06T16:56:54.390678631+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3101949,"latency_human":"3.101949ms","bytes_in":0,"bytes_out":95}
        {"time":"2025-02-06T16:56:55.388954652+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1944501,"latency_human":"1.944501ms","bytes_in":0,"bytes_out":95}
        time=2025-02-06T16:56:56.161+07:00 level=DEBUG msg="начало обработки заказов" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders
        time=2025-02-06T16:56:56.161+07:00 level=DEBUG msg="начало обработки заказов" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders
        time=2025-02-06T16:56:56.161+07:00 level=DEBUG msg="запрос заказов" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders статусы="[NEW PROCESSING]"
        time=2025-02-06T16:56:56.161+07:00 level=DEBUG msg="запрос заказов" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders статусы="[NEW PROCESSING]"
        time=2025-02-06T16:56:56.165+07:00 level=DEBUG msg="поиск заказов по статусам" environment=local package=repository component=OrderRepo method=FindByStatus статусы="[NEW PROCESSING]" количество=2
        time=2025-02-06T16:56:56.165+07:00 level=DEBUG msg="кол-во заказов для обработки воркером" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders количество=2
        time=2025-02-06T16:56:56.165+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=25 "номер заказа"=884657511 "текущий статус"=NEW
        time=2025-02-06T16:56:56.167+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=884657511
        time=2025-02-06T16:56:56.167+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=26 "номер заказа"=646566768067365 "текущий статус"=NEW
        time=2025-02-06T16:56:56.168+07:00 level=DEBUG msg="получена информация о начислении" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=646566768067365 статус=PROCESSED начисление=0xc0002c8db0
        time=2025-02-06T16:56:56.171+07:00 level=DEBUG msg="обновление суммы начисления" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=646566768067365 "начисление (руб)"=729.98 "начисление (коп)"=72998
        time=2025-02-06T16:56:56.171+07:00 level=INFO msg="обновление статуса на PROCESSED" environment=local package=repository component=OrderRepo method=UpdateAccrual "id заказа"=26 "начисление (коп)"=72998
        time=2025-02-06T16:56:56.176+07:00 level=DEBUG msg="поиск заказов по статусам" environment=local package=repository component=OrderRepo method=FindByStatus статусы="[NEW PROCESSING]" количество=1
        time=2025-02-06T16:56:56.176+07:00 level=DEBUG msg="кол-во заказов для обработки воркером" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders количество=1
        time=2025-02-06T16:56:56.176+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=25 "номер заказа"=884657511 "текущий статус"=NEW
        time=2025-02-06T16:56:56.176+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=884657511
        {"time":"2025-02-06T16:56:56.389714854+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3452031,"latency_human":"3.452031ms","bytes_in":0,"bytes_out":118}
        {"time":"2025-02-06T16:56:56.394578227+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/balance","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3903342,"latency_human":"3.903342ms","bytes_in":0,"bytes_out":33}
        {"time":"2025-02-06T16:56:56.401017411+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/balance/withdraw","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":5365618,"latency_human":"5.365618ms","bytes_in":49,"bytes_out":0}
        {"time":"2025-02-06T16:56:56.403246473+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/balance","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1565025,"latency_human":"1.565025ms","bytes_in":0,"bytes_out":37}
        {"time":"2025-02-06T16:56:56.405756943+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/withdrawals","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1544884,"latency_human":"1.544884ms","bytes_in":0,"bytes_out":86}
        {"time":"2025-02-06T16:56:56.572388818+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":165237072,"latency_human":"165.237072ms","bytes_in":81,"bytes_out":158}
        {"time":"2025-02-06T16:56:56.719666699+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/login","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":145307378,"latency_human":"145.307378ms","bytes_in":81,"bytes_out":158}
        {"time":"2025-02-06T16:56:56.721696286+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":401,"error":"code=401, message=Отсутствует токен авторизации","latency":58858,"latency_human":"58.858µs","bytes_in":7,"bytes_out":71}
        {"time":"2025-02-06T16:56:56.722288332+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":401,"error":"code=401, message=Отсутствует токен авторизации","latency":72160,"latency_human":"72.16µs","bytes_in":0,"bytes_out":71}
        {"time":"2025-02-06T16:56:56.873534769+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":150635098,"latency_human":"150.635098ms","bytes_in":59,"bytes_out":160}
        {"time":"2025-02-06T16:56:56.876824173+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":422,"error":"code=422, message=Неверный формат номера заказа","latency":1980418,"latency_human":"1.980418ms","bytes_in":11,"bytes_out":70}
        time=2025-02-06T16:56:56.881+07:00 level=INFO msg="created new order" environment=local id=27 uploaded_at=2025-02-06T16:56:56.879+07:00 user_id=72 order_number=6644181314104 status=NEW
        {"time":"2025-02-06T16:56:56.881105419+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":202,"error":"","latency":3555206,"latency_human":"3.555206ms","bytes_in":13,"bytes_out":0}
        {"time":"2025-02-06T16:56:56.882806199+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":957150,"latency_human":"957.15µs","bytes_in":13,"bytes_out":0}
        {"time":"2025-02-06T16:56:56.884178004+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":694567,"latency_human":"694.567µs","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-06T16:56:57.025670786+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":139624652,"latency_human":"139.624652ms","bytes_in":59,"bytes_out":166}
        {"time":"2025-02-06T16:56:57.027477084+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":409,"error":"code=409, message=Номер заказа уже был загружен другим пользователем","latency":1077042,"latency_human":"1.077042ms","bytes_in":13,"bytes_out":109}
        time=2025-02-06T16:56:57.028+07:00 level=INFO msg="received signal" environment=local signal=interrupt
        time=2025-02-06T16:56:57.028+07:00 level=INFO msg="shutting down server..." environment=local
        time=2025-02-06T16:56:57.028+07:00 level=INFO msg="server stopped" environment=local
    gophermart_suite_test.go:108: останавливаем процесс accrual
    gophermart_suite_test.go:140: Получен STDOUT лог процесса:
        
        {"level":"info","ts":1738835806.0341125,"caller":"accrual/main.go:52","msg":"starting HTTP server","addr":"localhost:33049"}
        {"level":"info","ts":1738835817.0326111,"caller":"accrual/main.go:63","msg":"shutting down gracefully","signal":"interrupt"}
--- PASS: TestGophermart (11.01s)
    --- PASS: TestGophermart/TestEndToEnd (10.17s)
        --- PASS: TestGophermart/TestEndToEnd/register_accrual_mechanic (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/register_order_for_accrual (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/register_user (0.14s)
        --- PASS: TestGophermart/TestEndToEnd/order_upload (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/await_order_processed (10.00s)
        --- PASS: TestGophermart/TestEndToEnd/check_balance (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/withdraw_balance (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/recheck_balance (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/check_withdrawals (0.00s)
    --- PASS: TestGophermart/TestUserAuth (0.31s)
        --- PASS: TestGophermart/TestUserAuth/register_user (0.17s)
        --- PASS: TestGophermart/TestUserAuth/login_user (0.15s)
    --- PASS: TestGophermart/TestUserOrders (0.31s)
        --- PASS: TestGophermart/TestUserOrders/unauthorized_order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/unauthorized_orders_list (0.00s)
        --- PASS: TestGophermart/TestUserOrders/register_user (0.15s)
        --- PASS: TestGophermart/TestUserOrders/bad_order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/duplicate_order_upload_same_user (0.00s)
        --- PASS: TestGophermart/TestUserOrders/orders_list (0.00s)
        --- PASS: TestGophermart/TestUserOrders/duplicate_order_upload_other_user (0.14s)
PASS
