=== RUN   TestGophermart
=== RUN   TestGophermart/TestEndToEnd
=== RUN   TestGophermart/TestEndToEnd/register_accrual_mechanic
=== RUN   TestGophermart/TestEndToEnd/register_order_for_accrual
=== RUN   TestGophermart/TestEndToEnd/register_user
=== RUN   TestGophermart/TestEndToEnd/order_upload
=== RUN   TestGophermart/TestEndToEnd/await_order_processed
=== RUN   TestGophermart/TestEndToEnd/check_balance
=== RUN   TestGophermart/TestEndToEnd/withdraw_balance
=== RUN   TestGophermart/TestEndToEnd/recheck_balance
=== RUN   TestGophermart/TestEndToEnd/check_withdrawals
=== RUN   TestGophermart/TestUserAuth
=== RUN   TestGophermart/TestUserAuth/register_user
=== RUN   TestGophermart/TestUserAuth/login_user
=== RUN   TestGophermart/TestUserOrders
=== RUN   TestGophermart/TestUserOrders/unauthorized_order_upload
=== RUN   TestGophermart/TestUserOrders/unauthorized_orders_list
=== RUN   TestGophermart/TestUserOrders/register_user
=== RUN   TestGophermart/TestUserOrders/bad_order_upload
=== RUN   TestGophermart/TestUserOrders/order_upload
=== RUN   TestGophermart/TestUserOrders/duplicate_order_upload_same_user
=== RUN   TestGophermart/TestUserOrders/orders_list
=== RUN   TestGophermart/TestUserOrders/duplicate_order_upload_other_user
=== NAME  TestGophermart
    gophermart_suite_test.go:105: останавливаем процесс gophermart
    gophermart_suite_test.go:140: Получен STDOUT лог процесса:
        
        time=2025-02-08T12:02:50.977+07:00 level=DEBUG msg="configuration sources" environment=local env_file_loaded=true RUN_ADDRESS="localhost:8082 (from .env)" DATABASE_URI="postgres://gophermart:password@localhost:5432/gophermart?sslmode=disable (from .env)" ACCRUAL_SYSTEM_ADDRESS="http://localhost:41175 (from .env)" JWT_SECRET=yo***v) JWT_EXPIRATION_PERIOD="24h0m0s (from .env)"
        time=2025-02-08T12:02:51.010+07:00 level=INFO msg="goose: no migrations to run. current version: 3" environment=local
        
           ____    __
          / __/___/ /  ___
         / _// __/ _ \/ _ \
        /___/\__/_//_/\___/ v4.11.4
        High performance, minimalist Go web framework
        https://echo.labstack.com
        ____________________________________O/_______
                                            O\
        time=2025-02-08T12:02:51.010+07:00 level=INFO msg="воркер начал работу" environment=local package=worker component=AccrualWorker worker_id=1
        time=2025-02-08T12:02:51.011+07:00 level=INFO msg="воркер начал работу" environment=local package=worker component=AccrualWorker worker_id=0
        ⇨ http server started on 127.0.0.1:8082
        {"time":"2025-02-08T12:02:51.281406063+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":215022015,"latency_human":"215.022015ms","bytes_in":57,"bytes_out":166}
        time=2025-02-08T12:02:51.288+07:00 level=INFO msg="created new order" environment=local id=33 uploaded_at=2025-02-08T12:02:51.286+07:00 user_id=93 order_number=43641113360 status=NEW
        {"time":"2025-02-08T12:02:51.288958218+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":202,"error":"","latency":6154848,"latency_human":"6.154848ms","bytes_in":11,"bytes_out":0}
        {"time":"2025-02-08T12:02:52.295904801+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":4576536,"latency_human":"4.576536ms","bytes_in":0,"bytes_out":90}
        {"time":"2025-02-08T12:02:53.2934956+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2367161,"latency_human":"2.367161ms","bytes_in":0,"bytes_out":90}
        {"time":"2025-02-08T12:02:54.293014663+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1984186,"latency_human":"1.984186ms","bytes_in":0,"bytes_out":90}
        {"time":"2025-02-08T12:02:55.293325282+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2389212,"latency_human":"2.389212ms","bytes_in":0,"bytes_out":90}
        {"time":"2025-02-08T12:02:56.294228707+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3196703,"latency_human":"3.196703ms","bytes_in":0,"bytes_out":90}
        {"time":"2025-02-08T12:02:57.294415944+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3105417,"latency_human":"3.105417ms","bytes_in":0,"bytes_out":90}
        {"time":"2025-02-08T12:02:58.293641618+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2287865,"latency_human":"2.287865ms","bytes_in":0,"bytes_out":90}
        {"time":"2025-02-08T12:02:59.292689202+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1681628,"latency_human":"1.681628ms","bytes_in":0,"bytes_out":90}
        {"time":"2025-02-08T12:03:00.292603154+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1993086,"latency_human":"1.993086ms","bytes_in":0,"bytes_out":90}
        time=2025-02-08T12:03:01.011+07:00 level=DEBUG msg="начало обработки заказов" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders
        time=2025-02-08T12:03:01.011+07:00 level=DEBUG msg="запрос заказов" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders статусы="[NEW PROCESSING]"
        time=2025-02-08T12:03:01.011+07:00 level=DEBUG msg="начало обработки заказов" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders
        time=2025-02-08T12:03:01.011+07:00 level=DEBUG msg="запрос заказов" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders статусы="[NEW PROCESSING]"
        time=2025-02-08T12:03:01.016+07:00 level=DEBUG msg="поиск заказов по статусам" environment=local package=repository component=OrderRepo method=FindByStatus статусы="[NEW PROCESSING]" количество=4
        time=2025-02-08T12:03:01.016+07:00 level=DEBUG msg="кол-во заказов для обработки воркером" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders количество=4
        time=2025-02-08T12:03:01.016+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=28 "номер заказа"=12345678903 "текущий статус"=NEW
        time=2025-02-08T12:03:01.017+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=12345678903
        time=2025-02-08T12:03:01.017+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=30 "номер заказа"=555326 "текущий статус"=NEW
        time=2025-02-08T12:03:01.018+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=555326
        time=2025-02-08T12:03:01.018+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=32 "номер заказа"=617655814315855 "текущий статус"=NEW
        time=2025-02-08T12:03:01.018+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=617655814315855
        time=2025-02-08T12:03:01.018+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=33 "номер заказа"=43641113360 "текущий статус"=NEW
        time=2025-02-08T12:03:01.019+07:00 level=DEBUG msg="получена информация о начислении" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=43641113360 статус=PROCESSED начисление=0xc0003202c0
        time=2025-02-08T12:03:01.024+07:00 level=DEBUG msg="обновление суммы начисления" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=43641113360 "начисление (руб)"=729.98 "начисление (коп)"=72998
        time=2025-02-08T12:03:01.024+07:00 level=INFO msg="обновление статуса на PROCESSED" environment=local package=repository component=OrderRepo method=UpdateAccrual "id заказа"=33 "начисление (коп)"=72998
        time=2025-02-08T12:03:01.029+07:00 level=DEBUG msg="поиск заказов по статусам" environment=local package=repository component=OrderRepo method=FindByStatus статусы="[NEW PROCESSING]" количество=3
        time=2025-02-08T12:03:01.029+07:00 level=DEBUG msg="кол-во заказов для обработки воркером" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders количество=3
        time=2025-02-08T12:03:01.029+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=28 "номер заказа"=12345678903 "текущий статус"=NEW
        time=2025-02-08T12:03:01.030+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=12345678903
        time=2025-02-08T12:03:01.030+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=30 "номер заказа"=555326 "текущий статус"=NEW
        time=2025-02-08T12:03:01.030+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=555326
        time=2025-02-08T12:03:01.030+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=32 "номер заказа"=617655814315855 "текущий статус"=NEW
        time=2025-02-08T12:03:01.031+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=617655814315855
        {"time":"2025-02-08T12:03:01.294140829+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3738870,"latency_human":"3.73887ms","bytes_in":0,"bytes_out":113}
        {"time":"2025-02-08T12:03:01.301490144+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/balance","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":5655807,"latency_human":"5.655807ms","bytes_in":0,"bytes_out":33}
        {"time":"2025-02-08T12:03:01.310476699+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/balance/withdraw","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":7996162,"latency_human":"7.996162ms","bytes_in":55,"bytes_out":0}
        {"time":"2025-02-08T12:03:01.31484348+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/balance","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3071649,"latency_human":"3.071649ms","bytes_in":0,"bytes_out":50}
        {"time":"2025-02-08T12:03:01.318440335+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/withdrawals","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2589877,"latency_human":"2.589877ms","bytes_in":0,"bytes_out":92}
        {"time":"2025-02-08T12:03:01.536424805+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":215801792,"latency_human":"215.801792ms","bytes_in":72,"bytes_out":158}
        {"time":"2025-02-08T12:03:01.747634036+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/login","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":209405231,"latency_human":"209.405231ms","bytes_in":72,"bytes_out":158}
        {"time":"2025-02-08T12:03:01.749444481+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":401,"error":"code=401, message=Отсутствует токен авторизации","latency":57378,"latency_human":"57.378µs","bytes_in":12,"bytes_out":71}
        {"time":"2025-02-08T12:03:01.750142651+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":401,"error":"code=401, message=Отсутствует токен авторизации","latency":45239,"latency_human":"45.239µs","bytes_in":0,"bytes_out":71}
        {"time":"2025-02-08T12:03:01.948979657+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":198243415,"latency_human":"198.243415ms","bytes_in":58,"bytes_out":164}
        {"time":"2025-02-08T12:03:01.95150664+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":422,"error":"code=422, message=Неверный формат номера заказа","latency":1555887,"latency_human":"1.555887ms","bytes_in":11,"bytes_out":70}
        time=2025-02-08T12:03:01.955+07:00 level=INFO msg="created new order" environment=local id=34 uploaded_at=2025-02-08T12:03:01.953+07:00 user_id=95 order_number=8111783 status=NEW
        {"time":"2025-02-08T12:03:01.955561399+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":202,"error":"","latency":3348093,"latency_human":"3.348093ms","bytes_in":7,"bytes_out":0}
        {"time":"2025-02-08T12:03:01.95704623+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":757372,"latency_human":"757.372µs","bytes_in":7,"bytes_out":0}
        {"time":"2025-02-08T12:03:01.958597309+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":957195,"latency_human":"957.195µs","bytes_in":0,"bytes_out":87}
        {"time":"2025-02-08T12:03:02.143425675+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":182774858,"latency_human":"182.774858ms","bytes_in":54,"bytes_out":160}
        {"time":"2025-02-08T12:03:02.145488877+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":409,"error":"code=409, message=Номер заказа уже был загружен другим пользователем","latency":1161767,"latency_human":"1.161767ms","bytes_in":7,"bytes_out":109}
        time=2025-02-08T12:03:02.146+07:00 level=INFO msg="received signal" environment=local signal=interrupt
        time=2025-02-08T12:03:02.146+07:00 level=INFO msg="shutting down server..." environment=local
        time=2025-02-08T12:03:02.146+07:00 level=INFO msg="server stopped" environment=local
    gophermart_suite_test.go:108: останавливаем процесс accrual
    gophermart_suite_test.go:140: Получен STDOUT лог процесса:
        
        {"level":"info","ts":1738990970.8628917,"caller":"accrual/main.go:52","msg":"starting HTTP server","addr":"localhost:41175"}
        {"level":"info","ts":1738990982.1499627,"caller":"accrual/main.go:63","msg":"shutting down gracefully","signal":"interrupt"}
--- PASS: TestGophermart (11.30s)
    --- PASS: TestGophermart/TestEndToEnd (10.26s)
        --- PASS: TestGophermart/TestEndToEnd/register_accrual_mechanic (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/register_order_for_accrual (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/register_user (0.22s)
        --- PASS: TestGophermart/TestEndToEnd/order_upload (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/await_order_processed (10.01s)
        --- PASS: TestGophermart/TestEndToEnd/check_balance (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/withdraw_balance (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/recheck_balance (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/check_withdrawals (0.00s)
    --- PASS: TestGophermart/TestUserAuth (0.43s)
        --- PASS: TestGophermart/TestUserAuth/register_user (0.22s)
        --- PASS: TestGophermart/TestUserAuth/login_user (0.21s)
    --- PASS: TestGophermart/TestUserOrders (0.40s)
        --- PASS: TestGophermart/TestUserOrders/unauthorized_order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/unauthorized_orders_list (0.00s)
        --- PASS: TestGophermart/TestUserOrders/register_user (0.20s)
        --- PASS: TestGophermart/TestUserOrders/bad_order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/duplicate_order_upload_same_user (0.00s)
        --- PASS: TestGophermart/TestUserOrders/orders_list (0.00s)
        --- PASS: TestGophermart/TestUserOrders/duplicate_order_upload_other_user (0.19s)
PASS
