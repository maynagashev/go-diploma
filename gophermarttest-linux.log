=== RUN   TestGophermart
=== RUN   TestGophermart/TestEndToEnd
=== RUN   TestGophermart/TestEndToEnd/register_accrual_mechanic
=== RUN   TestGophermart/TestEndToEnd/register_order_for_accrual
=== RUN   TestGophermart/TestEndToEnd/register_user
=== RUN   TestGophermart/TestEndToEnd/order_upload
=== RUN   TestGophermart/TestEndToEnd/await_order_processed
    gophermart_e2e_test.go:203: 
        	Error Trace:	/home/dev/src/maynagashev/gophermart/gophermart_e2e_test.go:203
        	            				/home/dev/src/maynagashev/gophermart/suite.go:91
        	Error:      	Not equal: 
        	            	expected: 729.98
        	            	actual  : 0
        	Test:       	TestGophermart/TestEndToEnd/await_order_processed
        	Messages:   	Начисление за заказ не соответствует ожидаемому
=== RUN   TestGophermart/TestEndToEnd/check_balance
    gophermart_e2e_test.go:219: 
        	Error Trace:	/home/dev/src/maynagashev/gophermart/gophermart_e2e_test.go:219
        	            				/home/dev/src/maynagashev/gophermart/suite.go:91
        	Error:      	[]int{200, 204} does not contain 404
        	Test:       	TestGophermart/TestEndToEnd/check_balance
        	Messages:   	Несоответствие статус кода ответа ожидаемому в хендлере 'GET http://localhost:8082/api/user/balance'
    gophermart_e2e_test.go:231: 
        	Error Trace:	/home/dev/src/maynagashev/gophermart/gophermart_e2e_test.go:231
        	            				/home/dev/src/maynagashev/gophermart/suite.go:91
        	Error:      	Not equal: 
        	            	expected: main.userBalance{Current:729.98, Withdrawn:0}
        	            	actual  : main.userBalance{Current:0, Withdrawn:0}
        	            	
        	            	Diff:
        	            	--- Expected
        	            	+++ Actual
        	            	@@ -1,3 +1,3 @@
        	            	 (main.userBalance) {
        	            	- Current: (float32) 729.98,
        	            	+ Current: (float32) 0,
        	            	  Withdrawn: (float32) 0
        	Test:       	TestGophermart/TestEndToEnd/check_balance
        	Messages:   	Баланс пользователя не соответствует ожидаемому
    gophermart_e2e_test.go:235: Оригинальный запрос:
        
        GET /api/user/balance HTTP/1.1
        Host: localhost:8082
        Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MzgzMTQ2NzYsImxvZ2luIjoiQ3h4Q0o2TmFjNFV1IiwidXNlcl9pZCI6NDl9.Jy1oxqQlK_5kYkbolif4Gs2N_JneriIGLuN7p3zVPKQ
        User-Agent: go-resty/2.7.0 (https://github.com/go-resty/resty)
        
=== RUN   TestGophermart/TestEndToEnd/withdraw_balance
    gophermart_e2e_test.go:260: 
        	Error Trace:	/home/dev/src/maynagashev/gophermart/gophermart_e2e_test.go:260
        	            				/home/dev/src/maynagashev/gophermart/suite.go:91
        	Error:      	Not equal: 
        	            	expected: 200
        	            	actual  : 404
        	Test:       	TestGophermart/TestEndToEnd/withdraw_balance
        	Messages:   	Несоответствие статус кода ответа ожидаемому в хендлере 'POST http://localhost:8082/api/user/balance/withdraw'
    gophermart_e2e_test.go:266: Оригинальный запрос:
        
        POST /api/user/balance/withdraw HTTP/1.1
        Host: localhost:8082
        Accept: application/json
        Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MzgzMTQ2NzYsImxvZ2luIjoiQ3h4Q0o2TmFjNFV1IiwidXNlcl9pZCI6NDl9.Jy1oxqQlK_5kYkbolif4Gs2N_JneriIGLuN7p3zVPKQ
        Content-Type: application/json
        User-Agent: go-resty/2.7.0 (https://github.com/go-resty/resty)
        
        
        {
        			"order": "2154177",
            		"sum": 127.68
        		}
        
=== RUN   TestGophermart/TestEndToEnd/recheck_balance
    gophermart_e2e_test.go:280: 
        	Error Trace:	/home/dev/src/maynagashev/gophermart/gophermart_e2e_test.go:280
        	            				/home/dev/src/maynagashev/gophermart/suite.go:91
        	Error:      	Not equal: 
        	            	expected: 200
        	            	actual  : 404
        	Test:       	TestGophermart/TestEndToEnd/recheck_balance
        	Messages:   	Несоответствие статус кода ответа ожидаемому в хендлере 'GET http://localhost:8082/api/user/balance'
    gophermart_e2e_test.go:289: 
        	Error Trace:	/home/dev/src/maynagashev/gophermart/gophermart_e2e_test.go:289
        	            				/home/dev/src/maynagashev/gophermart/suite.go:91
        	Error:      	Max difference between 602.2992 and 0 allowed is 0.01, but difference was 602.2991943359375
        	Test:       	TestGophermart/TestEndToEnd/recheck_balance
        	Messages:   	Баланс пользователя не соответствует ожидаемому
    gophermart_e2e_test.go:290: 
        	Error Trace:	/home/dev/src/maynagashev/gophermart/gophermart_e2e_test.go:290
        	            				/home/dev/src/maynagashev/gophermart/suite.go:91
        	Error:      	Max difference between 127.680756 and 0 allowed is 0.01, but difference was 127.68075561523438
        	Test:       	TestGophermart/TestEndToEnd/recheck_balance
        	Messages:   	Списанная сумма не соответствует ожидаемой
    gophermart_e2e_test.go:294: Оригинальный запрос:
        
        GET /api/user/balance HTTP/1.1
        Host: localhost:8082
        Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MzgzMTQ2NzYsImxvZ2luIjoiQ3h4Q0o2TmFjNFV1IiwidXNlcl9pZCI6NDl9.Jy1oxqQlK_5kYkbolif4Gs2N_JneriIGLuN7p3zVPKQ
        User-Agent: go-resty/2.7.0 (https://github.com/go-resty/resty)
        
=== RUN   TestGophermart/TestEndToEnd/check_withdrawals
    gophermart_e2e_test.go:309: 
        	Error Trace:	/home/dev/src/maynagashev/gophermart/gophermart_e2e_test.go:309
        	            				/home/dev/src/maynagashev/gophermart/suite.go:91
        	Error:      	Not equal: 
        	            	expected: 200
        	            	actual  : 404
        	Test:       	TestGophermart/TestEndToEnd/check_withdrawals
        	Messages:   	Несоответствие статус кода ответа ожидаемому в хендлере 'GET http://localhost:8082/api/user/withdrawals'
    gophermart_e2e_test.go:315: Оригинальный запрос:
        
        GET /api/user/withdrawals HTTP/1.1
        Host: localhost:8082
        Accept: application/json
        Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MzgzMTQ2NzYsImxvZ2luIjoiQ3h4Q0o2TmFjNFV1IiwidXNlcl9pZCI6NDl9.Jy1oxqQlK_5kYkbolif4Gs2N_JneriIGLuN7p3zVPKQ
        Content-Type: application/json
        User-Agent: go-resty/2.7.0 (https://github.com/go-resty/resty)
        
=== RUN   TestGophermart/TestUserAuth
=== RUN   TestGophermart/TestUserAuth/register_user
=== RUN   TestGophermart/TestUserAuth/login_user
=== RUN   TestGophermart/TestUserOrders
=== RUN   TestGophermart/TestUserOrders/unauthorized_order_upload
=== RUN   TestGophermart/TestUserOrders/unauthorized_orders_list
=== RUN   TestGophermart/TestUserOrders/register_user
=== RUN   TestGophermart/TestUserOrders/bad_order_upload
=== RUN   TestGophermart/TestUserOrders/order_upload
=== RUN   TestGophermart/TestUserOrders/duplicate_order_upload_same_user
=== RUN   TestGophermart/TestUserOrders/orders_list
=== RUN   TestGophermart/TestUserOrders/duplicate_order_upload_other_user
=== NAME  TestGophermart
    gophermart_suite_test.go:105: останавливаем процесс gophermart
    gophermart_suite_test.go:140: Получен STDOUT лог процесса:
        
        time=2025-01-30T16:11:16.192+07:00 level=INFO msg="goose: no migrations to run. current version: 2"
        
           ____    __
          / __/___/ /  ___
         / _// __/ _ \/ _ \
        /___/\__/_//_/\___/ v4.11.4
        High performance, minimalist Go web framework
        https://echo.labstack.com
        ____________________________________O/_______
                                            O\
        ⇨ http server started on 127.0.0.1:8082
        time=2025-01-30T16:11:16.193+07:00 level=INFO msg="воркер начал работу" worker_id=4
        time=2025-01-30T16:11:16.193+07:00 level=INFO msg="воркер начал работу" worker_id=1
        time=2025-01-30T16:11:16.193+07:00 level=INFO msg="воркер начал работу" worker_id=0
        time=2025-01-30T16:11:16.193+07:00 level=INFO msg="воркер начал работу" worker_id=2
        time=2025-01-30T16:11:16.193+07:00 level=INFO msg="воркер начал работу" worker_id=3
        {"time":"2025-01-30T16:11:16.42653493+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":159512655,"latency_human":"159.512655ms","bytes_in":57,"bytes_out":166}
        {"time":"2025-01-30T16:11:16.432152916+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":202,"error":"","latency":4413846,"latency_human":"4.413846ms","bytes_in":8,"bytes_out":0}
        {"time":"2025-01-30T16:11:17.436314835+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2173044,"latency_human":"2.173044ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-01-30T16:11:17.437464618+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/balance","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":404,"error":"code=404, message=Not Found","latency":59887,"latency_human":"59.887µs","bytes_in":0,"bytes_out":24}
        {"time":"2025-01-30T16:11:17.438635178+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/balance/withdraw","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":404,"error":"code=404, message=Not Found","latency":78614,"latency_human":"78.614µs","bytes_in":48,"bytes_out":24}
        {"time":"2025-01-30T16:11:17.439393887+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/balance","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":404,"error":"code=404, message=Not Found","latency":77851,"latency_human":"77.851µs","bytes_in":0,"bytes_out":24}
        {"time":"2025-01-30T16:11:17.440461923+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/withdrawals","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":404,"error":"code=404, message=Not Found","latency":63989,"latency_human":"63.989µs","bytes_in":0,"bytes_out":24}
        {"time":"2025-01-30T16:11:17.580885948+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":139120452,"latency_human":"139.120452ms","bytes_in":87,"bytes_out":161}
        {"time":"2025-01-30T16:11:17.719498948+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/login","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":137053701,"latency_human":"137.053701ms","bytes_in":87,"bytes_out":161}
        {"time":"2025-01-30T16:11:17.721362913+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":401,"error":"code=401, message=Отсутствует токен авторизации","latency":47571,"latency_human":"47.571µs","bytes_in":13,"bytes_out":71}
        {"time":"2025-01-30T16:11:17.721941832+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":401,"error":"code=401, message=Отсутствует токен авторизации","latency":12043,"latency_human":"12.043µs","bytes_in":0,"bytes_out":71}
        {"time":"2025-01-30T16:11:17.86103593+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":137791771,"latency_human":"137.791771ms","bytes_in":66,"bytes_out":160}
        {"time":"2025-01-30T16:11:17.864112129+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":422,"error":"code=422, message=Неверный формат номера заказа","latency":2245842,"latency_human":"2.245842ms","bytes_in":11,"bytes_out":70}
        {"time":"2025-01-30T16:11:17.868616426+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":202,"error":"","latency":3902246,"latency_human":"3.902246ms","bytes_in":14,"bytes_out":0}
        {"time":"2025-01-30T16:11:17.870636512+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1224547,"latency_human":"1.224547ms","bytes_in":14,"bytes_out":0}
        {"time":"2025-01-30T16:11:17.871855429+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":781156,"latency_human":"781.156µs","bytes_in":0,"bytes_out":94}
        {"time":"2025-01-30T16:11:18.053057822+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":180018460,"latency_human":"180.01846ms","bytes_in":59,"bytes_out":165}
        {"time":"2025-01-30T16:11:18.054944281+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":409,"error":"code=409, message=Номер заказа уже был загружен другим пользователем","latency":1143521,"latency_human":"1.143521ms","bytes_in":14,"bytes_out":109}
        time=2025-01-30T16:11:18.055+07:00 level=INFO msg="received signal" signal=interrupt
        time=2025-01-30T16:11:18.055+07:00 level=INFO msg="shutting down server..."
        time=2025-01-30T16:11:18.056+07:00 level=INFO msg="server stopped"
    gophermart_suite_test.go:108: останавливаем процесс accrual
    gophermart_suite_test.go:140: Получен STDOUT лог процесса:
        
        {"level":"info","ts":1738228276.0802987,"caller":"accrual/main.go:52","msg":"starting HTTP server","addr":"localhost:46777"}
        {"level":"info","ts":1738228278.0601022,"caller":"accrual/main.go:63","msg":"shutting down gracefully","signal":"interrupt"}
--- FAIL: TestGophermart (2.02s)
    --- FAIL: TestGophermart/TestEndToEnd (1.18s)
        --- PASS: TestGophermart/TestEndToEnd/register_accrual_mechanic (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/register_order_for_accrual (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/register_user (0.16s)
        --- PASS: TestGophermart/TestEndToEnd/order_upload (0.01s)
        --- FAIL: TestGophermart/TestEndToEnd/await_order_processed (1.00s)
        --- FAIL: TestGophermart/TestEndToEnd/check_balance (0.00s)
        --- FAIL: TestGophermart/TestEndToEnd/withdraw_balance (0.00s)
        --- FAIL: TestGophermart/TestEndToEnd/recheck_balance (0.00s)
        --- FAIL: TestGophermart/TestEndToEnd/check_withdrawals (0.00s)
    --- PASS: TestGophermart/TestUserAuth (0.28s)
        --- PASS: TestGophermart/TestUserAuth/register_user (0.14s)
        --- PASS: TestGophermart/TestUserAuth/login_user (0.14s)
    --- PASS: TestGophermart/TestUserOrders (0.34s)
        --- PASS: TestGophermart/TestUserOrders/unauthorized_order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/unauthorized_orders_list (0.00s)
        --- PASS: TestGophermart/TestUserOrders/register_user (0.14s)
        --- PASS: TestGophermart/TestUserOrders/bad_order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/duplicate_order_upload_same_user (0.00s)
        --- PASS: TestGophermart/TestUserOrders/orders_list (0.00s)
        --- PASS: TestGophermart/TestUserOrders/duplicate_order_upload_other_user (0.18s)
FAIL
