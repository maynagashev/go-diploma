=== RUN   TestGophermart
=== RUN   TestGophermart/TestEndToEnd
=== RUN   TestGophermart/TestEndToEnd/register_accrual_mechanic
=== RUN   TestGophermart/TestEndToEnd/register_order_for_accrual
=== RUN   TestGophermart/TestEndToEnd/register_user
=== RUN   TestGophermart/TestEndToEnd/order_upload
=== RUN   TestGophermart/TestEndToEnd/await_order_processed
=== RUN   TestGophermart/TestEndToEnd/check_balance
=== RUN   TestGophermart/TestEndToEnd/withdraw_balance
=== RUN   TestGophermart/TestEndToEnd/recheck_balance
=== RUN   TestGophermart/TestEndToEnd/check_withdrawals
=== RUN   TestGophermart/TestUserAuth
=== RUN   TestGophermart/TestUserAuth/register_user
=== RUN   TestGophermart/TestUserAuth/login_user
=== RUN   TestGophermart/TestUserOrders
=== RUN   TestGophermart/TestUserOrders/unauthorized_order_upload
=== RUN   TestGophermart/TestUserOrders/unauthorized_orders_list
=== RUN   TestGophermart/TestUserOrders/register_user
=== RUN   TestGophermart/TestUserOrders/bad_order_upload
=== RUN   TestGophermart/TestUserOrders/order_upload
=== RUN   TestGophermart/TestUserOrders/duplicate_order_upload_same_user
=== RUN   TestGophermart/TestUserOrders/orders_list
=== RUN   TestGophermart/TestUserOrders/duplicate_order_upload_other_user
=== NAME  TestGophermart
    gophermart_suite_test.go:105: останавливаем процесс gophermart
    gophermart_suite_test.go:140: Получен STDOUT лог процесса:
        
        time=2025-02-08T12:17:05.339+07:00 level=DEBUG msg="configuration sources" environment=local env_file_loaded=true RUN_ADDRESS="localhost:8082 (from .env)" DATABASE_URI="postgres://gophermart:password@localhost:5432/gophermart?sslmode=disable (from .env)" ACCRUAL_SYSTEM_ADDRESS="http://localhost:34903 (from .env)" JWT_SECRET=yo***v) JWT_EXPIRATION_PERIOD="24h0m0s (from .env)"
        time=2025-02-08T12:17:05.359+07:00 level=INFO msg="goose: no migrations to run. current version: 3" environment=local
        
           ____    __
          / __/___/ /  ___
         / _// __/ _ \/ _ \
        /___/\__/_//_/\___/ v4.11.4
        High performance, minimalist Go web framework
        https://echo.labstack.com
        ____________________________________O/_______
                                            O\
        time=2025-02-08T12:17:05.360+07:00 level=INFO msg="воркер начал работу" environment=local package=worker component=AccrualWorker worker_id=0
        time=2025-02-08T12:17:05.360+07:00 level=INFO msg="воркер начал работу" environment=local package=worker component=AccrualWorker worker_id=1
        ⇨ http server started on 127.0.0.1:8082
        {"time":"2025-02-08T12:17:05.652712405+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":227408235,"latency_human":"227.408235ms","bytes_in":68,"bytes_out":168}
        time=2025-02-08T12:17:05.658+07:00 level=INFO msg="created new order" environment=local id=37 uploaded_at=2025-02-08T12:17:05.656+07:00 user_id=101 order_number=81245146146363 status=NEW
        {"time":"2025-02-08T12:17:05.658816014+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":202,"error":"","latency":5185445,"latency_human":"5.185445ms","bytes_in":14,"bytes_out":0}
        {"time":"2025-02-08T12:17:06.665462842+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":4301241,"latency_human":"4.301241ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:17:07.661934101+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1886489,"latency_human":"1.886489ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:17:08.662604654+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1724273,"latency_human":"1.724273ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:17:09.662092586+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2010081,"latency_human":"2.010081ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:17:10.663515661+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3183800,"latency_human":"3.1838ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:17:11.663207372+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2091526,"latency_human":"2.091526ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:17:12.662257613+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1702602,"latency_human":"1.702602ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:17:13.661888624+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1739730,"latency_human":"1.73973ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:17:14.661866622+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1834361,"latency_human":"1.834361ms","bytes_in":0,"bytes_out":93}
        time=2025-02-08T12:17:15.361+07:00 level=DEBUG msg="начало обработки заказов" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders
        time=2025-02-08T12:17:15.361+07:00 level=DEBUG msg="начало обработки заказов" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders
        time=2025-02-08T12:17:15.361+07:00 level=DEBUG msg="запрос заказов" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders статусы="[NEW PROCESSING]"
        time=2025-02-08T12:17:15.361+07:00 level=DEBUG msg="запрос заказов" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders статусы="[NEW PROCESSING]"
        time=2025-02-08T12:17:15.365+07:00 level=DEBUG msg="поиск заказов по статусам" environment=local package=repository component=OrderRepo method=FindByStatus статусы="[NEW PROCESSING]" количество=6
        time=2025-02-08T12:17:15.366+07:00 level=DEBUG msg="кол-во заказов для обработки воркером" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders количество=6
        time=2025-02-08T12:17:15.366+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=28 "номер заказа"=12345678903 "текущий статус"=NEW
        time=2025-02-08T12:17:15.368+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=12345678903
        time=2025-02-08T12:17:15.368+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=30 "номер заказа"=555326 "текущий статус"=NEW
        time=2025-02-08T12:17:15.369+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=555326
        time=2025-02-08T12:17:15.369+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=32 "номер заказа"=617655814315855 "текущий статус"=NEW
        time=2025-02-08T12:17:15.370+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=617655814315855
        time=2025-02-08T12:17:15.370+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=34 "номер заказа"=8111783 "текущий статус"=NEW
        time=2025-02-08T12:17:15.370+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=8111783
        time=2025-02-08T12:17:15.370+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=36 "номер заказа"=607184 "текущий статус"=NEW
        time=2025-02-08T12:17:15.371+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=607184
        time=2025-02-08T12:17:15.371+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=37 "номер заказа"=81245146146363 "текущий статус"=NEW
        time=2025-02-08T12:17:15.371+07:00 level=DEBUG msg="получена информация о начислении" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=81245146146363 статус=PROCESSED начисление=0xc00046b510
        time=2025-02-08T12:17:15.375+07:00 level=DEBUG msg="обновление суммы начисления" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=81245146146363 "начисление (руб)"=729.98 "начисление (коп)"=72998
        time=2025-02-08T12:17:15.375+07:00 level=INFO msg="обновление статуса на PROCESSED" environment=local package=repository component=OrderRepo method=UpdateAccrual "id заказа"=37 "начисление (коп)"=72998
        time=2025-02-08T12:17:15.382+07:00 level=DEBUG msg="поиск заказов по статусам" environment=local package=repository component=OrderRepo method=FindByStatus статусы="[NEW PROCESSING]" количество=5
        time=2025-02-08T12:17:15.382+07:00 level=DEBUG msg="кол-во заказов для обработки воркером" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders количество=5
        time=2025-02-08T12:17:15.382+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=28 "номер заказа"=12345678903 "текущий статус"=NEW
        time=2025-02-08T12:17:15.383+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=12345678903
        time=2025-02-08T12:17:15.383+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=30 "номер заказа"=555326 "текущий статус"=NEW
        time=2025-02-08T12:17:15.384+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=555326
        time=2025-02-08T12:17:15.384+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=32 "номер заказа"=617655814315855 "текущий статус"=NEW
        time=2025-02-08T12:17:15.385+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=617655814315855
        time=2025-02-08T12:17:15.385+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=34 "номер заказа"=8111783 "текущий статус"=NEW
        time=2025-02-08T12:17:15.385+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=8111783
        time=2025-02-08T12:17:15.385+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=36 "номер заказа"=607184 "текущий статус"=NEW
        time=2025-02-08T12:17:15.386+07:00 level=DEBUG msg="заказ не найден в системе начислений" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "номер заказа"=607184
        {"time":"2025-02-08T12:17:15.664569005+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3829397,"latency_human":"3.829397ms","bytes_in":0,"bytes_out":116}
        {"time":"2025-02-08T12:17:15.671533652+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/balance","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":5758092,"latency_human":"5.758092ms","bytes_in":0,"bytes_out":33}
        {"time":"2025-02-08T12:17:15.679791065+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/balance/withdraw","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":7129743,"latency_human":"7.129743ms","bytes_in":55,"bytes_out":0}
        {"time":"2025-02-08T12:17:15.683308852+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/balance","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2640765,"latency_human":"2.640765ms","bytes_in":0,"bytes_out":50}
        {"time":"2025-02-08T12:17:15.687505108+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/withdrawals","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2914933,"latency_human":"2.914933ms","bytes_in":0,"bytes_out":92}
        {"time":"2025-02-08T12:17:15.894017975+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":204069139,"latency_human":"204.069139ms","bytes_in":81,"bytes_out":161}
        {"time":"2025-02-08T12:17:16.068965403+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/login","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":173803671,"latency_human":"173.803671ms","bytes_in":81,"bytes_out":161}
        {"time":"2025-02-08T12:17:16.070747237+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":401,"error":"code=401, message=Отсутствует токен авторизации","latency":109857,"latency_human":"109.857µs","bytes_in":11,"bytes_out":71}
        {"time":"2025-02-08T12:17:16.071389976+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":401,"error":"code=401, message=Отсутствует токен авторизации","latency":16660,"latency_human":"16.66µs","bytes_in":0,"bytes_out":71}
        {"time":"2025-02-08T12:17:16.263243241+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":191284483,"latency_human":"191.284483ms","bytes_in":68,"bytes_out":169}
        {"time":"2025-02-08T12:17:16.265656154+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":422,"error":"code=422, message=Неверный формат номера заказа","latency":1613354,"latency_human":"1.613354ms","bytes_in":11,"bytes_out":70}
        time=2025-02-08T12:17:16.270+07:00 level=INFO msg="created new order" environment=local id=38 uploaded_at=2025-02-08T12:17:16.268+07:00 user_id=103 order_number=552011058 status=NEW
        {"time":"2025-02-08T12:17:16.271030782+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":202,"error":"","latency":4655824,"latency_human":"4.655824ms","bytes_in":9,"bytes_out":0}
        {"time":"2025-02-08T12:17:16.272995904+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1074571,"latency_human":"1.074571ms","bytes_in":9,"bytes_out":0}
        {"time":"2025-02-08T12:17:16.274746599+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":883676,"latency_human":"883.676µs","bytes_in":0,"bytes_out":89}
        {"time":"2025-02-08T12:17:16.500241215+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":224087348,"latency_human":"224.087348ms","bytes_in":61,"bytes_out":169}
        {"time":"2025-02-08T12:17:16.50228038+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":409,"error":"code=409, message=Номер заказа уже был загружен другим пользователем","latency":1161255,"latency_human":"1.161255ms","bytes_in":9,"bytes_out":109}
        time=2025-02-08T12:17:16.503+07:00 level=INFO msg="received signal" environment=local signal=interrupt
        time=2025-02-08T12:17:16.503+07:00 level=INFO msg="shutting down server..." environment=local
        time=2025-02-08T12:17:16.504+07:00 level=INFO msg="server stopped" environment=local
    gophermart_suite_test.go:108: останавливаем процесс accrual
    gophermart_suite_test.go:140: Получен STDOUT лог процесса:
        
        {"level":"info","ts":1738991825.2227035,"caller":"accrual/main.go:52","msg":"starting HTTP server","addr":"localhost:34903"}
        {"level":"info","ts":1738991836.5086508,"caller":"accrual/main.go:63","msg":"shutting down gracefully","signal":"interrupt"}
--- PASS: TestGophermart (11.30s)
    --- PASS: TestGophermart/TestEndToEnd (10.27s)
        --- PASS: TestGophermart/TestEndToEnd/register_accrual_mechanic (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/register_order_for_accrual (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/register_user (0.23s)
        --- PASS: TestGophermart/TestEndToEnd/order_upload (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/await_order_processed (10.01s)
        --- PASS: TestGophermart/TestEndToEnd/check_balance (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/withdraw_balance (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/recheck_balance (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/check_withdrawals (0.00s)
    --- PASS: TestGophermart/TestUserAuth (0.38s)
        --- PASS: TestGophermart/TestUserAuth/register_user (0.21s)
        --- PASS: TestGophermart/TestUserAuth/login_user (0.18s)
    --- PASS: TestGophermart/TestUserOrders (0.43s)
        --- PASS: TestGophermart/TestUserOrders/unauthorized_order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/unauthorized_orders_list (0.00s)
        --- PASS: TestGophermart/TestUserOrders/register_user (0.19s)
        --- PASS: TestGophermart/TestUserOrders/bad_order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/order_upload (0.01s)
        --- PASS: TestGophermart/TestUserOrders/duplicate_order_upload_same_user (0.00s)
        --- PASS: TestGophermart/TestUserOrders/orders_list (0.00s)
        --- PASS: TestGophermart/TestUserOrders/duplicate_order_upload_other_user (0.23s)
PASS
