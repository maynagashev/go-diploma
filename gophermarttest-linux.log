=== RUN   TestGophermart
=== RUN   TestGophermart/TestEndToEnd
=== RUN   TestGophermart/TestEndToEnd/register_accrual_mechanic
=== RUN   TestGophermart/TestEndToEnd/register_order_for_accrual
=== RUN   TestGophermart/TestEndToEnd/register_user
=== RUN   TestGophermart/TestEndToEnd/order_upload
=== RUN   TestGophermart/TestEndToEnd/await_order_processed
=== RUN   TestGophermart/TestEndToEnd/check_balance
=== RUN   TestGophermart/TestEndToEnd/withdraw_balance
=== RUN   TestGophermart/TestEndToEnd/recheck_balance
=== RUN   TestGophermart/TestEndToEnd/check_withdrawals
=== RUN   TestGophermart/TestUserAuth
=== RUN   TestGophermart/TestUserAuth/register_user
=== RUN   TestGophermart/TestUserAuth/login_user
=== RUN   TestGophermart/TestUserOrders
=== RUN   TestGophermart/TestUserOrders/unauthorized_order_upload
=== RUN   TestGophermart/TestUserOrders/unauthorized_orders_list
=== RUN   TestGophermart/TestUserOrders/register_user
=== RUN   TestGophermart/TestUserOrders/bad_order_upload
=== RUN   TestGophermart/TestUserOrders/order_upload
=== RUN   TestGophermart/TestUserOrders/duplicate_order_upload_same_user
=== RUN   TestGophermart/TestUserOrders/orders_list
=== RUN   TestGophermart/TestUserOrders/duplicate_order_upload_other_user
=== NAME  TestGophermart
    gophermart_suite_test.go:105: останавливаем процесс gophermart
    gophermart_suite_test.go:140: Получен STDOUT лог процесса:
        
        time=2025-02-08T12:22:39.320+07:00 level=DEBUG msg="configuration sources" environment=local env_file_loaded=true RUN_ADDRESS="localhost:8082 (from .env)" DATABASE_URI="postgres://gophermart:password@localhost:5432/gophermart?sslmode=disable (from .env)" ACCRUAL_SYSTEM_ADDRESS="http://localhost:37497 (from .env)" JWT_SECRET=yo***v) JWT_EXPIRATION_PERIOD="24h0m0s (from .env)"
        time=2025-02-08T12:22:39.350+07:00 level=INFO msg="goose: no migrations to run. current version: 3" environment=local
        
           ____    __
          / __/___/ /  ___
         / _// __/ _ \/ _ \
        /___/\__/_//_/\___/ v4.11.4
        High performance, minimalist Go web framework
        https://echo.labstack.com
        ____________________________________O/_______
                                            O\
        time=2025-02-08T12:22:39.351+07:00 level=INFO msg="воркер начал работу" environment=local package=worker component=AccrualWorker worker_id=1
        time=2025-02-08T12:22:39.351+07:00 level=INFO msg="воркер начал работу" environment=local package=worker component=AccrualWorker worker_id=0
        ⇨ http server started on 127.0.0.1:8082
        {"time":"2025-02-08T12:22:39.61284192+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":201785198,"latency_human":"201.785198ms","bytes_in":66,"bytes_out":162}
        time=2025-02-08T12:22:39.620+07:00 level=INFO msg="created new order" environment=local id=39 uploaded_at=2025-02-08T12:22:39.618+07:00 user_id=105 order_number=32433887751068 status=NEW
        {"time":"2025-02-08T12:22:39.620440831+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":202,"error":"","latency":5607207,"latency_human":"5.607207ms","bytes_in":14,"bytes_out":0}
        {"time":"2025-02-08T12:22:40.625027264+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":3442157,"latency_human":"3.442157ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:22:41.624068131+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2180771,"latency_human":"2.180771ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:22:42.624271737+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2197736,"latency_human":"2.197736ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:22:43.624016668+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1969851,"latency_human":"1.969851ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:22:44.623432941+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1352592,"latency_human":"1.352592ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:22:45.627106685+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":5210309,"latency_human":"5.210309ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:22:46.624593721+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2370817,"latency_human":"2.370817ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:22:47.62398937+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1778810,"latency_human":"1.77881ms","bytes_in":0,"bytes_out":93}
        {"time":"2025-02-08T12:22:48.623742601+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1839108,"latency_human":"1.839108ms","bytes_in":0,"bytes_out":93}
        time=2025-02-08T12:22:49.351+07:00 level=DEBUG msg="начало обработки заказов" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders
        time=2025-02-08T12:22:49.351+07:00 level=DEBUG msg="начало обработки заказов" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders
        time=2025-02-08T12:22:49.351+07:00 level=DEBUG msg="запрос заказов" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders статусы="[NEW PROCESSING]"
        time=2025-02-08T12:22:49.351+07:00 level=DEBUG msg="запрос заказов" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders статусы="[NEW PROCESSING]"
        time=2025-02-08T12:22:49.355+07:00 level=DEBUG msg="поиск заказов по статусам" environment=local package=repository component=OrderRepo method=FindByStatus статусы="[NEW PROCESSING]" количество=7
        time=2025-02-08T12:22:49.355+07:00 level=DEBUG msg="кол-во заказов для обработки воркером" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders количество=7
        time=2025-02-08T12:22:49.355+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=28 "номер заказа"=12345678903 "текущий статус"=NEW
        time=2025-02-08T12:22:49.357+07:00 level=ERROR msg="failed to get order accrual" environment=local package=worker component=AccrualWorker order_number=12345678903 error="заказ не найден в системе начислений"
        time=2025-02-08T12:22:49.357+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=30 "номер заказа"=555326 "текущий статус"=NEW
        time=2025-02-08T12:22:49.357+07:00 level=ERROR msg="failed to get order accrual" environment=local package=worker component=AccrualWorker order_number=555326 error="заказ не найден в системе начислений"
        time=2025-02-08T12:22:49.357+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=32 "номер заказа"=617655814315855 "текущий статус"=NEW
        time=2025-02-08T12:22:49.360+07:00 level=ERROR msg="failed to get order accrual" environment=local package=worker component=AccrualWorker order_number=617655814315855 error="заказ не найден в системе начислений"
        time=2025-02-08T12:22:49.360+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=34 "номер заказа"=8111783 "текущий статус"=NEW
        time=2025-02-08T12:22:49.361+07:00 level=ERROR msg="failed to get order accrual" environment=local package=worker component=AccrualWorker order_number=8111783 error="заказ не найден в системе начислений"
        time=2025-02-08T12:22:49.361+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=36 "номер заказа"=607184 "текущий статус"=NEW
        time=2025-02-08T12:22:49.361+07:00 level=ERROR msg="failed to get order accrual" environment=local package=worker component=AccrualWorker order_number=607184 error="заказ не найден в системе начислений"
        time=2025-02-08T12:22:49.361+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=38 "номер заказа"=552011058 "текущий статус"=NEW
        time=2025-02-08T12:22:49.362+07:00 level=ERROR msg="failed to get order accrual" environment=local package=worker component=AccrualWorker order_number=552011058 error="заказ не найден в системе начислений"
        time=2025-02-08T12:22:49.362+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "id заказа"=39 "номер заказа"=32433887751068 "текущий статус"=NEW
        time=2025-02-08T12:22:49.362+07:00 level=DEBUG msg="получена информация о начислении" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=32433887751068 статус=PROCESSED начисление=0xc0002c88e0
        time=2025-02-08T12:22:49.367+07:00 level=DEBUG msg="обновление суммы начисления" environment=local package=worker component=AccrualWorker worker_id=1 method=processOrders "номер заказа"=32433887751068 "начисление (руб)"=729.98 "начисление (коп)"=72998
        time=2025-02-08T12:22:49.367+07:00 level=INFO msg="обновление статуса на PROCESSED" environment=local package=repository component=OrderRepo method=UpdateAccrual "id заказа"=39 "начисление (коп)"=72998
        time=2025-02-08T12:22:49.370+07:00 level=DEBUG msg="поиск заказов по статусам" environment=local package=repository component=OrderRepo method=FindByStatus статусы="[NEW PROCESSING]" количество=6
        time=2025-02-08T12:22:49.370+07:00 level=DEBUG msg="кол-во заказов для обработки воркером" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders количество=6
        time=2025-02-08T12:22:49.370+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=28 "номер заказа"=12345678903 "текущий статус"=NEW
        time=2025-02-08T12:22:49.371+07:00 level=ERROR msg="failed to get order accrual" environment=local package=worker component=AccrualWorker order_number=12345678903 error="заказ не найден в системе начислений"
        time=2025-02-08T12:22:49.371+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=30 "номер заказа"=555326 "текущий статус"=NEW
        time=2025-02-08T12:22:49.371+07:00 level=ERROR msg="failed to get order accrual" environment=local package=worker component=AccrualWorker order_number=555326 error="заказ не найден в системе начислений"
        time=2025-02-08T12:22:49.371+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=32 "номер заказа"=617655814315855 "текущий статус"=NEW
        time=2025-02-08T12:22:49.372+07:00 level=ERROR msg="failed to get order accrual" environment=local package=worker component=AccrualWorker order_number=617655814315855 error="заказ не найден в системе начислений"
        time=2025-02-08T12:22:49.372+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=34 "номер заказа"=8111783 "текущий статус"=NEW
        time=2025-02-08T12:22:49.373+07:00 level=ERROR msg="failed to get order accrual" environment=local package=worker component=AccrualWorker order_number=8111783 error="заказ не найден в системе начислений"
        time=2025-02-08T12:22:49.373+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=36 "номер заказа"=607184 "текущий статус"=NEW
        time=2025-02-08T12:22:49.373+07:00 level=ERROR msg="failed to get order accrual" environment=local package=worker component=AccrualWorker order_number=607184 error="заказ не найден в системе начислений"
        time=2025-02-08T12:22:49.373+07:00 level=DEBUG msg="обработка заказа" environment=local package=worker component=AccrualWorker worker_id=0 method=processOrders "id заказа"=38 "номер заказа"=552011058 "текущий статус"=NEW
        time=2025-02-08T12:22:49.374+07:00 level=ERROR msg="failed to get order accrual" environment=local package=worker component=AccrualWorker order_number=552011058 error="заказ не найден в системе начислений"
        {"time":"2025-02-08T12:22:49.626551964+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":4566978,"latency_human":"4.566978ms","bytes_in":0,"bytes_out":116}
        {"time":"2025-02-08T12:22:49.633192954+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/balance","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":5468328,"latency_human":"5.468328ms","bytes_in":0,"bytes_out":33}
        {"time":"2025-02-08T12:22:49.642708384+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/balance/withdraw","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":7988970,"latency_human":"7.98897ms","bytes_in":47,"bytes_out":0}
        {"time":"2025-02-08T12:22:49.645351825+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/balance","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1877245,"latency_human":"1.877245ms","bytes_in":0,"bytes_out":38}
        {"time":"2025-02-08T12:22:49.648432661+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/withdrawals","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":2139315,"latency_human":"2.139315ms","bytes_in":0,"bytes_out":84}
        {"time":"2025-02-08T12:22:49.871111723+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":220317597,"latency_human":"220.317597ms","bytes_in":79,"bytes_out":158}
        {"time":"2025-02-08T12:22:50.073120287+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/login","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":200223998,"latency_human":"200.223998ms","bytes_in":79,"bytes_out":158}
        {"time":"2025-02-08T12:22:50.074999191+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":401,"error":"code=401, message=Отсутствует токен авторизации","latency":157890,"latency_human":"157.89µs","bytes_in":8,"bytes_out":71}
        {"time":"2025-02-08T12:22:50.076005624+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":401,"error":"code=401, message=Отсутствует токен авторизации","latency":22979,"latency_human":"22.979µs","bytes_in":0,"bytes_out":71}
        {"time":"2025-02-08T12:22:50.294434349+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":217309548,"latency_human":"217.309548ms","bytes_in":58,"bytes_out":169}
        {"time":"2025-02-08T12:22:50.297506348+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":422,"error":"code=422, message=Неверный формат номера заказа","latency":1870353,"latency_human":"1.870353ms","bytes_in":11,"bytes_out":70}
        time=2025-02-08T12:22:50.303+07:00 level=INFO msg="created new order" environment=local id=40 uploaded_at=2025-02-08T12:22:50.301+07:00 user_id=107 order_number=703273423029 status=NEW
        {"time":"2025-02-08T12:22:50.303698211+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":202,"error":"","latency":5106000,"latency_human":"5.106ms","bytes_in":12,"bytes_out":0}
        {"time":"2025-02-08T12:22:50.305878472+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1329068,"latency_human":"1.329068ms","bytes_in":12,"bytes_out":0}
        {"time":"2025-02-08T12:22:50.307975605+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"GET","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":1205459,"latency_human":"1.205459ms","bytes_in":0,"bytes_out":92}
        {"time":"2025-02-08T12:22:50.519635957+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/register","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":200,"error":"","latency":209943081,"latency_human":"209.943081ms","bytes_in":61,"bytes_out":162}
        {"time":"2025-02-08T12:22:50.52164238+07:00","id":"","remote_ip":"127.0.0.1","host":"localhost:8082","method":"POST","uri":"/api/user/orders","user_agent":"go-resty/2.7.0 (https://github.com/go-resty/resty)","status":409,"error":"code=409, message=Номер заказа уже был загружен другим пользователем","latency":1367013,"latency_human":"1.367013ms","bytes_in":12,"bytes_out":109}
        time=2025-02-08T12:22:50.522+07:00 level=INFO msg="received signal" environment=local signal=interrupt
        time=2025-02-08T12:22:50.522+07:00 level=INFO msg="shutting down server..." environment=local
        time=2025-02-08T12:22:50.523+07:00 level=INFO msg="server stopped" environment=local
    gophermart_suite_test.go:108: останавливаем процесс accrual
    gophermart_suite_test.go:140: Получен STDOUT лог процесса:
        
        {"level":"info","ts":1738992159.2070472,"caller":"accrual/main.go:52","msg":"starting HTTP server","addr":"localhost:37497"}
        {"level":"info","ts":1738992170.5265656,"caller":"accrual/main.go:63","msg":"shutting down gracefully","signal":"interrupt"}
--- PASS: TestGophermart (11.33s)
    --- PASS: TestGophermart/TestEndToEnd (10.25s)
        --- PASS: TestGophermart/TestEndToEnd/register_accrual_mechanic (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/register_order_for_accrual (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/register_user (0.20s)
        --- PASS: TestGophermart/TestEndToEnd/order_upload (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/await_order_processed (10.01s)
        --- PASS: TestGophermart/TestEndToEnd/check_balance (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/withdraw_balance (0.01s)
        --- PASS: TestGophermart/TestEndToEnd/recheck_balance (0.00s)
        --- PASS: TestGophermart/TestEndToEnd/check_withdrawals (0.00s)
    --- PASS: TestGophermart/TestUserAuth (0.42s)
        --- PASS: TestGophermart/TestUserAuth/register_user (0.22s)
        --- PASS: TestGophermart/TestUserAuth/login_user (0.20s)
    --- PASS: TestGophermart/TestUserOrders (0.45s)
        --- PASS: TestGophermart/TestUserOrders/unauthorized_order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/unauthorized_orders_list (0.00s)
        --- PASS: TestGophermart/TestUserOrders/register_user (0.22s)
        --- PASS: TestGophermart/TestUserOrders/bad_order_upload (0.00s)
        --- PASS: TestGophermart/TestUserOrders/order_upload (0.01s)
        --- PASS: TestGophermart/TestUserOrders/duplicate_order_upload_same_user (0.00s)
        --- PASS: TestGophermart/TestUserOrders/orders_list (0.00s)
        --- PASS: TestGophermart/TestUserOrders/duplicate_order_upload_other_user (0.21s)
PASS
